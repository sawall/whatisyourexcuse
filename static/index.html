<!DOCTYPE html>
<html lang="en" >

<head>
  <meta charset="UTF-8">
  <title>What's your excuse?</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">   
  <link href="https://fonts.googleapis.com/css?family=Crete+Round" rel="stylesheet">
  <link href="/style.css" rel="stylesheet">

  <!-- open graph -->
  <meta property="og:url"         content="http://whatisyourexcuse.vote/"/>
  <meta property="og:type"        content="website" />
  <meta property="og:title"       content="Voting Excuse Generator" />
  <meta property="og:description" content="What is your excuse not to vote?" />
  <meta property="og:image"       content="http://whatisyourexcuse.vote/img/eagle.jpg" />

  <!-- favicons generated by http://www.favicomatic.com/ -->
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/img/apple-touch-icon-57x57.png"/>
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/img/apple-touch-icon-60x60.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/img/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/img/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/img/apple-touch-icon-152x152.png" />
  <link rel="icon" type="image/png" href="/img/favicon-196x196.png" sizes="196x196" />
  <link rel="icon" type="image/png" href="/img/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16" />
  <link rel="icon" type="image/png" href="/img/favicon-128.png" sizes="128x128" />
  <meta name="application-name" content="&nbsp;"/>
  <meta name="msapplication-TileColor" content="#FFFFFF" />
  <meta name="msapplication-TileImage" content="mstile-144x144.png" />
  <meta name="msapplication-square70x70logo" content="mstile-70x70.png" />
  <meta name="msapplication-square150x150logo" content="mstile-150x150.png" />
  <meta name="msapplication-wide310x150logo" content="mstile-310x150.png" />
  <meta name="msapplication-square310x310logo" content="mstile-310x310.png" />

   <!-- Social media icons by AlfredoCreates under the Creative Commons 3.0 attribution license
        ref: https://www.iconfinder.com/iconsets/black-white-social-media under
        license: https://creativecommons.org/licenses/by/3.0/ -->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-127474610-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-127474610-1');
  </script>
</head>

<body>
  <header>
    <a href="/">
      <div class="banner">VOTING EXCUSE GENERATOR</div>
    </a>
  </header>
  <div class="frames"> </div>
  <div class="links_to_things">
    <div class="resources">
      <div class="resource left">
        <a class="res_btn" href="https://www.rockthevote.org/register-to-vote/" target="_blank">
          Get Registered
        </a>
      </div>
      <div class="resource right">
        <a class="res_btn" href="https://www.headcount.org/voter-info/" target="_blank">
          How To Vote
        </a>
      </div>
      <div class="resource left">
        <a class="res_btn" href="https://www.rockthevote.org/resources/election-reminders/" target="_blank">
          Never Miss a Vote
        </a>
      </div>
      <div class="resource right">
        <a class="res_btn" href="https://ballotpedia.org/Sample_Ballot_Lookup" target="_blank">
          Find My Ballot
        </a>
      </div>
    </div>
  </div>
  <div class="footer">
    <div class="share">
      <div class="links">
        <p><a href="mailto:whatisyourexcuse.vote@gmail.com" title="Are we missing an excuse? Send us an email!">Submit an excuse</a>
        <span class="credits">
          credits: we are just some people, ya know?  
        </span></p>
      </div>
    </div>
  </div>
  
  <script src='jquery-3.3.1.min.js'></script>
  <script src='memes.js'></script>
  <script>
    // globals
    var cursor = 1 + Math.floor((excuse.length - 1)*Math.random());
    var frames = $('.frames');
    var current_meme, old_meme;

    // function defs
    function build_meme(excuse, meme, alt, footnote, info, hash, quip) {
      // change open graph tags
      let site_url = window.location.protocol + '//' + window.location.hostname;
      let meme_url = site_url + '#' + hash;
      let meme_imgloc = site_url + '/img/' + meme;
      $('meta[property="og:url"]').attr('content', meme_url);
      $('meta[property="og:image"]').attr('content', meme_imgloc);
      $('meta[property="og:title"]').attr('content', 'Voting Excuse: ' + excuse);
      $('meta[property="og:description"]').attr('content', footnote);

      return `<div class="frame future">
                ${ (excuse => {
                  if(excuse) return `<div class="item excuse">"${excuse}"</div>`
                  else return `<div class="item excuse"></div>`
                 })(excuse) }
                <div class="item meme">
                  <img src="/img/${meme}" alt="${alt}">
                </div>
                <div class="item footnote">${footnote}</div>
                <div class="item buttons">
                ${ (info => {
                  if(info) return `<a href="${info}" class="quip" target="_blank">Tell Me More!</a>`
                  else return ``
                })(info) }
                  <a href="javascript:void(0);" class="quip yeahand">
                  ${ (quip => {
                    if(quip) return `${quip}`
                    else return `Yeah, AND?` 
                  })(quip)}
                  </a>
                </div>
                <div class="item social">
                  <a href="javascript:void(0);" class="shareFacebook">
                    <img src="/img/share_facebook_black.svg">
                  </a>
                  <a href="javascript:void(0);" class="shareTwitter">
                    <img src="/img/share_twitter_black.svg">
                  </a>
                  <a href="javascript:void(0);" class="sharePinterest">
                    <img src="/img/share_pinterest_black.svg">
                  </a>
                  <a href="javascript:void(0);" class="shareEmail">
                    <img src="/img/share_email_black.svg">
                  </a>
                </div>`;
    }

    function setup_social(cursor) {
        let site_url = window.location.protocol + '//' + window.location.hostname;
        let meme_url = encodeURIComponent(site_url + "#" + hashes[cursor]); 
        let meme_imgloc = site_url + '/img/' + meme[cursor];
        let desc = encodeURIComponent("Voting Excuse Generator");
        alert(meme_imgloc);
        if (excuse[cursor] != "") {
            desc = desc + " - " + excuse[cursor];
        } 

        $('.shareFacebook').click(function (f) {
            window.open("https://www.facebook.com/sharer/sharer.php?" +
                "u=" + meme_url, "pop", "width=600, height=400, scrollbars=no");
            return false;
	    });

        $('.shareTwitter').click(function (f) {
            window.open("https://twitter.com/intent/tweet?text=" + desc +
                "&url=" + meme_url + "test", "pop", "width=600, height=400, scrollbars=no");
            // TODO: add twitter user
            return false;
	    });
        $('.sharePinterest').click(function (f) {
            window.open("https://www.pinterest.com/pin/create/button/?" +
                "url=" + meme_url + "&media=" + meme_imgloc + "&description=" + desc, "pop",
                "width=600, height=400, scrollbars=no");
            // TODO: add hashtags
            return false;
        });
        $('.shareEmail').click(function (f) {
            window.open("mailto:?subject=" + desc + "&body=" + meme_url);
            return false;
        });
    }

    function next_meme() {
      cursor = (cursor >= excuse.length -1) ? 1 : cursor + 1;
      let old_meme = current_meme;
      let memeHash = hashes[cursor];
      current_meme = $(build_meme(excuse[cursor], meme[cursor], alt[cursor], footnotes[cursor],
                       info[cursor], memeHash)).appendTo(frames);
      setup_social(cursor);
      old_meme.addClass('past');
      setTimeout(function(){
        current_meme.removeClass('future');				
        window.location.hash = hashes[cursor];
        setTimeout(function(){ old_meme.remove(); }, 600);
      }, 200);
    }
  
    $(document).ready(function(){
      // check to see if there is a meme
      var memeHash = window.location.hash.substr(1);
      var memeIdx = hashes.indexOf(memeHash);
      if (memeIdx != 0) {
        current_meme = $(build_meme(excuse[memeIdx], meme[memeIdx], alt[memeIdx],
                         footnotes[memeIdx], info[memeIdx], memeHash)).appendTo(frames);
      } else {
        // the eagle has landed
        current_meme = $(build_meme(excuse[0], meme[0], alt[0], footnotes[0],
                         "", "", "I've Got A Great Excuse!")).appendTo(frames);
      }
      current_meme.removeClass('future');				
      setup_social(memeIdx);
    
      $('.frames').delegate('a.yeahand', 'click', function(){
        next_meme();
      });
    });
  </script>
</body>
</html>
